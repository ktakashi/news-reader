#!/bin/sh
#| -*- mode:scheme; coding:utf-8 -*-
this_path=`dirname "$0"`
SAGITTARIUS=${SAGITTARIUS:-"sagittarius"}
exec $SAGITTARIUS -L${this_path}/../lib $0 "$@"
|#

(import (rnrs)
	(news-reader commands)
	(news-reader database)
	(util logging)
	(getopt)
	(dbi))

(define dbi-conn (make-dbi-connection))

(define process-feed (generate-process-feed dbi-conn))

(define (make-console-logger level)
  (make-async-logger level (make-appender "[~w5] [~l] ~m")))
(define (main args)
  (with-args (cdr args)
      ((d (#\d "debug") #f #f) . rest)
    (when (null? rest)
      (print "process-feed [-d] NAME")
      (exit -1))
    (*command-logger* (make-console-logger (if d +debug-level+ +info-level+)))
    (process-feed (car rest))))
